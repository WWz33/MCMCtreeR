<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MCMCtreeR: plotting time trees • MCMCtreeR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="MCMCtreeR: plotting time trees">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MCMCtreeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/MCMCtree_plot.html">MCMCtreeR: plotting time trees</a></li>
    <li><a class="dropdown-item" href="../articles/MCMCtree.html">MCMCtreeR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>MCMCtreeR: plotting time trees</h1>
                        <h4 data-toc-skip class="author">Mark
Puttick</h4>
                        <h4 data-toc-skip class="author"><a href="mailto:marknputtick@gmail.com" class="email">marknputtick@gmail.com</a></h4>
                        <h4 data-toc-skip class="author">University of
Bath</h4>
            
            <h4 data-toc-skip class="date">26 August 2024</h4>
      

      <div class="d-none name"><code>MCMCtree_plot.Rmd</code></div>
    </div>

    
    
<p><img src="MCMCtree_plot_fig/plot1unnamed-chunk-2-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This guide demonstrates the <code>MCMC.tree.plot</code> function that
plots time trees output from divergence time analysis using the
molecular (or morphological) clock. <code>MCMC.tree.plot</code> includes
options to plot the Bayesian HPD age distribution for each node as node
bars or the full distribution, and also includes arguments to plot a
geological and/or absolute timescale.</p>
<p><code>MCMC.tree.plot</code> can take any timescaled tree from any
software as long as it is read into R in <a href="https://CRAN.R-project.org/package=ape" class="external-link">APE</a> format. The
function contains methods to read in and summarise posterior age
estimates for analyses from <a href="http://nbisweden.github.io/MrBayes/" class="external-link">MrBayes</a>, <a href="https://revbayes.github.io/" class="external-link">RevBayes</a>, and <a href="http://abacus.gene.ucl.ac.uk/software/paml.html" class="external-link">MCMCtree</a>.
However <strong>any</strong> tree and uncertainty can be plotted the
phylogeny and posterior age estimates are given as arguments to the
function.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The data in these examples are taken from an MCMCtree divergence time
analysis. <a href="https://doi.org/10.1073/pnas.1719588115" class="external-link">Morris
<em>et al</em> 2018</a>. From the <code>MCMCtreeR</code> package, users
can directly call (using the <code>data</code> function) the object
<code>MCMCtree.output</code> that contains a phylogeny output from
MCMCtree <code>MCMCtree.phy</code> and a full posterior output from the
analysis <code>MCMCtree.posterior</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">"MCMCtreeR"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"MCMCtreeR"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MCMCtreeR</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">MCMCtree.output</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">MCMCtree.output</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">MCMCtree.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "MCMCtree.phy"       "MCMCtree.posterior"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readMCMCTree.html">readMCMCtree</a></span><span class="op">(</span><span class="va">MCMCtree.phy</span>, from.file <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-geological-and-absolute-ages-on-plot">Plot geological and absolute ages on plot<a class="anchor" aria-label="anchor" href="#plot-geological-and-absolute-ages-on-plot"></a>
</h2>
<p>For all plot types, <code>MCMC.tree.plot</code> includes options to
incorporate absolute and geological timescales on the tree figure. For
example, in Figure 1 the geologic times Eon and Period are displayed at
the bottom of the tree, with absolute ages in millions of years before
present at the top. The plotting of absolute timescales is controlled by
setting the <code>add.time.scale</code> option to <code>TRUE</code> (the
default). The absolute ages that are included reflect the designations
marked by the geologic time periods <code>scale res</code> argument. So
here absolute ages are shown for each Period at the top of the plot. As
<code>grey.bars</code> is <code>TRUE</code> shading is also used to
delimit each geologic Period.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>, time.correction <span class="op">=</span> <span class="fl">100</span>, scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>,</span>
<span>    <span class="st">"Period"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"phylogram"</span>, cex.age <span class="op">=</span> <span class="fl">0.6</span>, cex.labels <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>    relative.height <span class="op">=</span> <span class="fl">0.08</span>, col.tree <span class="op">=</span> <span class="st">"grey40"</span>, label.offset <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    node.method <span class="op">=</span> <span class="st">"none"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-4-1.png" alt="**Figure 1** Phylogeny with posterior distributions of age on nodes and timescale" width="576"><p class="caption">
<strong>Figure 1</strong> Phylogeny with posterior distributions of age
on nodes and timescale
</p>
</div>
<p>In Figure 2, the same plot is shown with <code>scale res</code> set
to show all geological age options (Eon, Period, Epoch, Age), which
looks too busy for this tree as it spans &gt; 900 million years, but may
be better for other trees that span smaller time frames.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>, time.correction <span class="op">=</span> <span class="fl">100</span>, scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>,</span>
<span>    <span class="st">"Period"</span>, <span class="st">"Epoch"</span>, <span class="st">"Age"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"phylogram"</span>, cex.age <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    cex.labels <span class="op">=</span> <span class="fl">0.5</span>, relative.height <span class="op">=</span> <span class="fl">0.08</span>, col.tree <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    label.offset <span class="op">=</span> <span class="fl">4</span>, node.method <span class="op">=</span> <span class="st">"none"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-5-1.png" alt="**Figure 2** Phylogeny with posterior distributions of age on nodes and timescale showing all units" width="576"><p class="caption">
<strong>Figure 2</strong> Phylogeny with posterior distributions of age
on nodes and timescale showing all units
</p>
</div>
</div>
<div class="section level2">
<h2 id="plot-node-uncertainty">Plot node uncertainty<a class="anchor" aria-label="anchor" href="#plot-node-uncertainty"></a>
</h2>
<p>Timescaled phylogenies can be plotted as the default ‘phylogram’
type. On these phylogenies uncertainty can be plotted as node bars,
similar to those used in <a href="http://beast.community/figtree" class="external-link">FigTree</a>. Note the argument
<code>time.correction</code> is used to rescale the MCMCtree ages to
absolute time by multiplying all ages by 100. In Figure 3, uncertainty
is presented using bars to highight the upper and lower Highest
Posterior Density of each age.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, analysis.type <span class="op">=</span> <span class="st">"MCMCtree"</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, plot.type <span class="op">=</span> <span class="st">"phylogram"</span>, lwd.bar <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, node.method <span class="op">=</span> <span class="st">"bar"</span>, col.age <span class="op">=</span> <span class="st">"navy"</span>,</span>
<span>    no.margin <span class="op">=</span> <span class="cn">TRUE</span>, label.offset <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-6-1.png" alt="**Figure 3** Phylogeny with age uncertainty displayed as bars on nodes." width="576"><p class="caption">
<strong>Figure 3</strong> Phylogeny with age uncertainty displayed as
bars on nodes.
</p>
</div>
<p>In this example (Figure 4), the age range of uncertainty for bars are
spread across the vertical height of each node using the option
<code>node.length</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, analysis.type <span class="op">=</span> <span class="st">"MCMCtree"</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, plot.type <span class="op">=</span> <span class="st">"phylogram"</span>, lwd.bar <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, node.method <span class="op">=</span> <span class="st">"node.length"</span>,</span>
<span>    col.age <span class="op">=</span> <span class="st">"#008b0040"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span>, label.offset <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-7-1.png" alt="**Figure 4** Phylogeny with age uncertainty displayed spanning the vertical height of the node." width="576"><p class="caption">
<strong>Figure 4</strong> Phylogeny with age uncertainty displayed
spanning the vertical height of the node.
</p>
</div>
<p>Finally, bars can be displayed across the entire vertical range of
the plot. This is useful if one node age is of particular interest, such
as in Figure 4 in which the age uncertainty (HPD interval) for node 110
(embryophytes) is highlighted alone.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, analysis.type <span class="op">=</span> <span class="st">"MCMCtree"</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, plot.type <span class="op">=</span> <span class="st">"phylogram"</span>, lwd.bar <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, node.method <span class="op">=</span> <span class="st">"full.length"</span>,</span>
<span>    all.nodes <span class="op">=</span> <span class="fl">110</span>, col.age <span class="op">=</span> <span class="st">"#ff000040"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    label.offset <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-8-1.png" alt="**Figure 5** Phylogeny with age uncertainty of one node spanning the height of the phylogeny." width="576"><p class="caption">
<strong>Figure 5</strong> Phylogeny with age uncertainty of one node
spanning the height of the phylogeny.
</p>
</div>
<div class="section level3">
<h3 id="mrbayes">Mrbayes<a class="anchor" aria-label="anchor" href="#mrbayes"></a>
</h3>
<p>The above examples were for MCMCtree analyses, these plots can also
be produced for MrBayes trees. Here no tree object is provided but the
full directory to the tree file is provided for the
<code>directory.files</code> argument. This is then read in and plotted
by the function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directory.mb &lt;- '/User/MrBayes/output.nex.con.tre'</span></span>
<span><span class="co"># MCMC.tree.plot(analysis.type='mrbayes',</span></span>
<span><span class="co"># directory.files=directory.mb, cex.tips=0.33,</span></span>
<span><span class="co"># plot.type='phylogram', lwd.bar=2, add.time.scale=FALSE,</span></span>
<span><span class="co"># node.method='bar', col.age='navy')</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="revbayes">RevBayes<a class="anchor" aria-label="anchor" href="#revbayes"></a>
</h3>
<p>RevBayes trees can read in the same way as MrBayes trees.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directory.rb &lt;- '/User/RevBayes/output.nex.con.tre'</span></span>
<span><span class="co"># MCMC.tree.plot(analysis.type='revbayes',</span></span>
<span><span class="co"># directory.files=directory.rb, cex.tips=0.33,</span></span>
<span><span class="co"># plot.type='phylogram', lwd.bar=2, add.time.scale=FALSE,</span></span>
<span><span class="co"># node.method='bar', col.age='navy')</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cladogram">Cladogram<a class="anchor" aria-label="anchor" href="#cladogram"></a>
</h3>
<p>Cladogram trees can be plot for output from MCMCtree analysis. In
Figure 6, the ‘MCMCtree’ node uncertainty is summarised using
phylogenetic cladogram plot in which with HPD age uncertainty spans the
entire branch length.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, analysis.type <span class="op">=</span> <span class="st">"MCMCtree"</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, plot.type <span class="op">=</span> <span class="st">"cladogram"</span>, lwd.bar <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, node.method <span class="op">=</span> <span class="st">"node.length"</span>,</span>
<span>    col.age <span class="op">=</span> <span class="st">"#008b0080"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span>, cex.labels <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-11-1.png" alt="**Figure 6** Cladogram plot" width="576"><p class="caption">
<strong>Figure 6</strong> Cladogram plot
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plot-full-distribution-on-nodes">Plot full distribution on nodes<a class="anchor" aria-label="anchor" href="#plot-full-distribution-on-nodes"></a>
</h2>
<p>If the full posterior is supplied as well as the tree, the
<code>plot.type</code> argument can be set to <code>distributions</code>
to display the full distribution of age estimates for each node of the
plot. In Figure 7, the full sample of ages is displayed for every node
on the phylogeny.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, MCMC.chain <span class="op">=</span> <span class="va">MCMCtree.posterior</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, plot.type <span class="op">=</span> <span class="st">"distributions"</span>, cex.age <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    cex.labels <span class="op">=</span> <span class="fl">0.5</span>, relative.height <span class="op">=</span> <span class="fl">0.08</span>, col.tree <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span>, label.offset <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    density.col <span class="op">=</span> <span class="st">"#00000050"</span>, density.border.col <span class="op">=</span> <span class="st">"#00000080"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-12-1.png" alt="**Figure 7** Phylogeny with posterior distributions of age on nodes." width="576"><p class="caption">
<strong>Figure 7</strong> Phylogeny with posterior distributions of age
on nodes.
</p>
</div>
<p>The colour of the node distributions is set using
<code>density.col</code> and <code>density.border.col</code>. Some nodes
can be given different colours. In Figure 8, the root node here is
coloured red and all other nodes are blue.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node.colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"#ff008050"</span>, <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Nnode</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">apePhy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">node.colours.border</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"#ff008090"</span>, <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Nnode</a></span><span class="op">(</span><span class="va">phy</span><span class="op">$</span><span class="va">apePhy</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">node.colours</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#00008050"</span></span>
<span><span class="va">node.colours.border</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#00008090"</span></span>
<span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span><span class="va">phy</span>, MCMC.chain <span class="op">=</span> <span class="va">MCMCtree.posterior</span>, cex.tips <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>    time.correction <span class="op">=</span> <span class="fl">100</span>, scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"distributions"</span>,</span>
<span>    cex.age <span class="op">=</span> <span class="fl">0.4</span>, cex.labels <span class="op">=</span> <span class="fl">0.5</span>, relative.height <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>    col.tree <span class="op">=</span> <span class="st">"grey40"</span>, col.age <span class="op">=</span> <span class="st">"black"</span>, density.col <span class="op">=</span> <span class="va">node.colours</span>,</span>
<span>    density.border.col <span class="op">=</span> <span class="va">node.colours.border</span>, grey.bars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-13-1.png" alt="**Figure 8** Phylogeny with posterior distributions of age on nodes, with the root a different colour." width="576"><p class="caption">
<strong>Figure 8</strong> Phylogeny with posterior distributions of age
on nodes, with the root a different colour.
</p>
</div>
</div>
<div class="section level2">
<h2 id="plot-tree-and-timescale-from-any-software">Plot tree and timescale from any software<a class="anchor" aria-label="anchor" href="#plot-tree-and-timescale-from-any-software"></a>
</h2>
<p>Using the ‘user’ option in the argument <code>analysis.type</code> it
is possible to plot trees, timescales, and age uncertainty, with files
output from any software.</p>
<p>The function only needs to be provided with a time-scaled phylogeny,
and the full posterior age estimates for each node. This user input
information is provided as a list to the argument
<code>node.ages</code>.</p>
<p>For this example, we are using the MCMCtree output, but the process
should be applicable to any divergence time software output. The
<code>MCMC.tree.plot</code> function requires that the object
<code>node.ages</code> is organised so the each element contains the
full age posterior for each node, and this element is allocated a name
that match the labels APE tree$edge object. The first element in the
list supplied to <code>node.ages</code> is the root node.</p>
<p>Here the ‘user’ approach is set-up step-by-step. First we store the
tree in APE format as a new object, and also create a new object for the
<code>phy$edge</code> object which summarises the tree structure in the
APE matrix format. Finally the MCMC chain is stored as a new object. For
the purposes of these examples, we use a subset of the phylogeny the
descends from node 177.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">MCMCtree.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in data(MCMCtree.output): data set 'MCMCtree.output' not found</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">MCMCtree.output</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The following objects are masked from MCMCtree.output (pos = 3):</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     MCMCtree.phy, MCMCtree.posterior</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from MCMCtree.output (pos = 4):</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     MCMCtree.phy, MCMCtree.posterior</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readMCMCTree.html">readMCMCtree</a></span><span class="op">(</span><span class="va">MCMCtree.phy</span>, from.file <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">phy</span> <span class="op">&lt;-</span> <span class="va">phy</span><span class="op">$</span><span class="va">apePhy</span></span>
<span><span class="co"># Here a smaller tree is shown as an example.</span></span>
<span><span class="va">phy.small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/drop.tip.html" class="external-link">extract.clade</a></span><span class="op">(</span><span class="va">phy</span>, <span class="fl">177</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">phy.small</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span>, cex <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="co"># view nodelabels on the tree</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">nodelabels</a></span><span class="op">(</span>cex <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-14-1.png" alt="**Figure 9** Phylogeny showing the node and tip labels." width="288"><p class="caption">
<strong>Figure 9</strong> Phylogeny showing the node and tip labels.
</p>
</div>
<p>This tree plot in Figure 9 shows the timescaled phylogeny. On this
plot the blue squares correspond to internal node labels. The input
needs a list with each element containing the ages from the appropriate
node (Figure 9).</p>
<p>Here the list is constructing and each element name is assigned with
the corresponding node value, and these are filled with random ages from
a normal distribution. In a real example this would be subsituted with
real data.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">node.numbers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">15</span><span class="op">)</span></span>
<span><span class="co"># create a list to store each posterior sample for every</span></span>
<span><span class="co"># node</span></span>
<span><span class="va">node.posteriors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Nnode</a></span><span class="op">(</span><span class="va">phy.small</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">node.posteriors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">node.numbers</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Nnode</a></span><span class="op">(</span><span class="va">phy.small</span><span class="op">)</span><span class="op">)</span> <span class="va">node.posteriors</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>,</span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/branching.times.html" class="external-link">branching.times</a></span><span class="op">(</span><span class="va">phy.small</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">## substitute the random numbers with the appropriate</span></span>
<span><span class="co">## posterior distribution for that node e.g.,</span></span>
<span><span class="co">## your.age.values &lt;-</span></span>
<span><span class="co">## read.csv('posterior.ages.from.an.analysis') for(i in</span></span>
<span><span class="co">## 1:Nnode(phy.small)) node.posteriors[[i]] &lt;-</span></span>
<span><span class="co">## your.age.values</span></span></code></pre></div>
<p>These data can now be displayed using the <code>MCMC.tree.plot</code>
function (Figure 10) in which the node.posteriors are provided to the
function as a list using the <code>node.ages argument</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">phy.small</span>, node.ages <span class="op">=</span> <span class="va">node.posteriors</span>,</span>
<span>    analysis.type <span class="op">=</span> <span class="st">"user"</span>, cex.tips <span class="op">=</span> <span class="fl">0.7</span>, time.correction <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>, <span class="st">"Period"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"distributions"</span>,</span>
<span>    cex.age <span class="op">=</span> <span class="fl">0.7</span>, cex.labels <span class="op">=</span> <span class="fl">0.5</span>, relative.height <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>    col.tree <span class="op">=</span> <span class="st">"grey40"</span>, no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-16-1.png" alt="**Figure 10** Phylogeny showing the node and tip labels." width="384"><p class="caption">
<strong>Figure 10</strong> Phylogeny showing the node and tip labels.
</p>
</div>
<p>This is a second example in which we use real data from an MCMCtree
analysus. Again, the names of the list elements storing the posterior
age arguments need match the nodelabels from the APE tree. As above, a
good way to investigate this is to plot trees and then using the
<code><a href="https://rdrr.io/pkg/ape/man/nodelabels.html" class="external-link">nodelabels()</a></code> function to visualise how the nodelabels are
found on the tree.</p>
<p>In the MCMCtree output file, node ages are stored in the second
column onwards. So we extract these data and then remove the ‘t_n’ label
from each column header so we are left with just the node numbers. And
then we sort the node numbers from MCMCtree analysis so that they match
the node labels in the APE format.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Not run. Plot tree with node labels to help work out how</span></span>
<span><span class="co"># labels correspond to tree from software output.</span></span>
<span><span class="co"># plot(ape) nodelabels() extract the MCMC chain and the</span></span>
<span><span class="co"># phylogeny edge object</span></span>
<span><span class="va">MCMC.chain</span> <span class="op">&lt;-</span> <span class="va">MCMCtree.posterior</span></span>
<span><span class="va">phy.edge</span> <span class="op">&lt;-</span> <span class="va">phy</span><span class="op">$</span><span class="va">edge</span></span>
<span><span class="co"># extract ages with node age posteriors from column 2</span></span>
<span><span class="va">MCMC.node.ages</span> <span class="op">&lt;-</span> <span class="va">MCMC.chain</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Ntip</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># extract the names from these data so they are numeric</span></span>
<span><span class="co"># node labels that match the APE tree format</span></span>
<span><span class="va">all.nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"t_n"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">MCMC.node.ages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># create a vector of names for each list element as</span></span>
<span><span class="co"># internal nodes from APE tree, using phy$edge object.</span></span>
<span><span class="va">node.ages.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Ntip</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">phy.edge</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">phy.edge</span><span class="op">[</span>,</span>
<span>    <span class="fl">2</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/summary.phylo.html" class="external-link">Ntip</a></span><span class="op">(</span><span class="va">phy</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># find where each posterior node age appears in APE edge</span></span>
<span><span class="co"># object.</span></span>
<span><span class="va">match.nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">all.nodes</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">node.ages.names</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># create a list extracting the information from the MCMC</span></span>
<span><span class="co"># chain in APE node order.</span></span>
<span><span class="va">node.ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">match.nodes</span>, <span class="kw">function</span><span class="op">(</span><span class="va">uu</span><span class="op">)</span> <span class="va">MCMC.node.ages</span><span class="op">[</span>,</span>
<span>    <span class="va">uu</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># name each element in list.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">node.ages</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">node.ages.names</span></span></code></pre></div>
<p>The <code>node.ages</code> object is input to
<code>MCMC.tree.plot</code> with the argument <code>analysis.type</code>
set to ‘user’ to plot the timescaled tree and full distributions on each
node (Figure 11).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mcmc.tree.plot.html">MCMC.tree.plot</a></span><span class="op">(</span>phy <span class="op">=</span> <span class="va">phy</span>, node.ages <span class="op">=</span> <span class="va">node.ages</span>, analysis.type <span class="op">=</span> <span class="st">"user"</span>,</span>
<span>    cex.tips <span class="op">=</span> <span class="fl">0.2</span>, time.correction <span class="op">=</span> <span class="fl">100</span>, scale.res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Eon"</span>,</span>
<span>        <span class="st">"Period"</span><span class="op">)</span>, plot.type <span class="op">=</span> <span class="st">"distributions"</span>, cex.age <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>    cex.labels <span class="op">=</span> <span class="fl">0.5</span>, relative.height <span class="op">=</span> <span class="fl">0.08</span>, col.tree <span class="op">=</span> <span class="st">"grey40"</span>,</span>
<span>    no.margin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MCMCtree_plot_files/figure-html/unnamed-chunk-18-1.png" alt="**Figure 11** Phylogeny plotted with user-formatted data." width="576"><p class="caption">
<strong>Figure 11</strong> Phylogeny plotted with user-formatted data.
</p>
</div>
<p><strong>References</strong></p>
<ul>
<li>Morris JL, Puttick MN, Clark JW, Edwards, Kenrick PD, Pressel S,
Wellman CH, Yang Z, Schneider H, and Donoghue PCJ. 2018. The timescale
of early land plant evolution. <strong>Proceedings of the National
Academy of Sciences USA</strong>. (<a href="https://doi.org/10.1073/pnas.1719588115" class="external-link uri">https://doi.org/10.1073/pnas.1719588115</a>)</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Puttick.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
